---
title: "Week 11 Assignment Final R"
output: html_document
date: "2025-04-17"
---
```{r}
library(xgboost)
library(mlbench)
library(data.table)
library(caret)
# library(microbenchmark)
library(purrr)
```

```{r}
dt <- data.table(dfdata)
dt <- na.omit(dt)

set.seed(2025)
tr.rows <- createDataPartition(y = dt$outcome,
                               p = 0.8)
```


```{r}
# Define sample fractions
frac_values <- c(0.000001, 0.00001, 0.0001, 0.001, 0.01, 0.1)

# Initialize results list
results <- data.frame(
  Frac = numeric(),
  SampleSize = integer(),
  Accuracy = numeric(),
  Time = numeric(),
  stringsAsFactors = FALSE
)

```

# First approach - basic xgboost with basic Cross Validation

```{r}
# Loop through fractions
for (frac in frac_values) {
  cat("\nRunning frac =", frac, "...\n")
  
  # Subsample data
  dt_sub <- dt[sample(.N, size = ceiling(.N * frac), replace = FALSE)]

  # Ensure both classes are represented
  if (length(unique(dt_sub$outcome)) < 2) {
    cat("Skipping frac =", frac, "- not enough class variability.\n")
    next
  }
  
  # Train/Test Split (80/20)
  set.seed(2025)
  tr_idx <- createDataPartition(dt_sub$outcome, p = 0.8, list = FALSE)
  train <- dt_sub[tr_idx]
  test  <- dt_sub[-tr_idx]

  # Prepare matrices for xgboost
  x_train <- as.matrix(train[, !"outcome"])
  y_train <- train$outcome
  x_test  <- as.matrix(test[, !"outcome"])
  y_test  <- test$outcome

  # Timer start
  t0 <- Sys.time()

  # Fit XGBoost model
  model <- xgboost(data = x_train,
                   label = y_train,
                   objective = "binary:logistic",
                   nrounds = 50,
                   verbose = 0)

  # Predict
  preds <- predict(model, x_test)
  y_pred <- ifelse(preds > 0.5, 1, 0)

  # Timer end
  t1 <- Sys.time()
  
  acc <- mean(y_pred == y_test)
  duration <- round(as.numeric(difftime(t1, t0, units = "secs")), 2)

  # Append result
  results <- rbind(results, data.frame(
    Frac = frac,
    SampleSize = nrow(dt_sub),
    Accuracy = round(acc, 4),
    Time = duration
  ))
}

# Print results table
print(results)

```

